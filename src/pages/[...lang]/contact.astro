---
import Layout from '~/layouts/PageLayout.astro';
import HeroText from '~/components/widgets/HeroText.astro';
import ContactUs from '~/components/widgets/Contact.astro';
import Features2 from '~/components/widgets/Features2.astro';
import ItemGrid3 from '~/components/ui/ItemGrid3.astro';
import type { ContentEntryMap } from "astro:content";
import { getListPage } from "~/utils/lib/contentParser.astro";
import { supportedLang } from "~/utils/lib/languageParser";

export function getStaticPaths() {
  const paths = supportedLang.map((lang) => ({
    params: { lang: lang || undefined },
  }));
  return paths;
}

const { lang } = Astro.params;

const contactPage = await getListPage("contact", lang as keyof ContentEntryMap);
if (!contactPage || contactPage.length === 0 || !contactPage[0].data) {
  throw new Error("Contact content not found for language: " + lang);
}

const { metadata, hero, contactForm, features, locations } = contactPage[0].data;

const defaultLocationImages = [
  {
    src: '~/assets/images/map-herndon.jpg',
    alt: 'Maps location image',
    href: 'https://www.google.com/maps/place/13873+Park+Center+Rd,+Herndon,+VA+20171',
  },
  {
    src: '~/assets/images/map-washington.png',
    alt: 'Maps location image',
    href: 'https://www.google.com/maps/place/1200+G+St+NW,+Washington,+DC+20005',
  },
  {
    src: '~/assets/images/map-newyork.png',
    alt: 'Maps location image',
    href: 'https://www.google.com/maps/place/14+Wall+St+20th+Floor,+New+York,+NY+10005',
  },
  {
    src: '~/assets/images/map-istanbul-1.png',
    alt: 'Maps location image',
    href: 'https://www.google.com/maps/place/Trump+Towers,+Residence+2901,+34381,+Şişli/İstanbul+Türkiye',
  },
];

const locationItems =
  locations?.items?.map((location, index) => ({
    title: location.title,
    description: location.description,
    image: location.image ?? defaultLocationImages[index],
  })) ?? [];
---

<Layout metadata={metadata}>
  <!-- HeroText Widget ******************* -->
  <HeroText tagline={hero.tagline} title={hero.title} />

  <!-- ContactUs Widget ******************* -->
  <ContactUs
    id="form"
    title={contactForm.title}
    subtitle={contactForm.subtitle}
    inputs={[
      { type: 'text', name: 'name', label: contactForm.inputs.name },
      { type: 'email', name: 'email', label: contactForm.inputs.email },
      { type: 'tel', name: 'phone', label: contactForm.inputs.phone },
    ]}
    textarea={{ label: contactForm.textarea }}
    disclaimer={{ label: contactForm.disclaimer }}
    description={contactForm.description}
  />

  <!-- Features2 Widget ******************* -->
  <Features2
    title={features.title}
    items={features.items}
  />

  <!-- ItemGrid3 Widget for Office Locations ******************* -->
  <ItemGrid3
    items={locationItems}
    columns={4}
    classes={{
      container: 'gap-4 md:gap-6',
      panel: 'rounded-lg shadow-[0_4px_30px_rgba(0,0,0,0.1)] backdrop-blur border border-[#ffffff29] bg-white p-6',
      icon: 'w-16 h-16 mb-6 text-primary',
    }}
  />
</Layout>
